# 流控/流媒体

## 初衷

1. 熟悉/了解一下 音视频流的传输与开发，方便应用层代码的开发，也好跟声网/外部公司做对接
2. 如果有需求方就想要一套 RTC 架构，不想使用3方的服务，那么
    1. 知道如何开发，从哪里下手，选用哪些框架、播放器、类库等
    2. 知道招聘什么样的人
    3. 知道如何做项目预算/评估
3. 看一下 RTC 在元宇宙/AR领域 有无关系
4. 对 RTC 有一颗敬畏的心

## 历史

现代意义上的电话大概是美国 1904（最早可追溯到1877）左右 弄出来的，中国大概是70~80兴起，也算是人类的高科技产品，还有像：蒸汽机 汽车等等，这里主要聊音视频。

电话也可以理解为：音频的通话，它也有自己的相关技术，如：交互换、分组交换机

> 70~80年代的中国，发电报得去邮局。可以看见，业务员操作一个大大的机器，来回挺拔线

后期互联网的崛起又产生了新的相关技术/协议：VOIP/SIP 等\(网上打电话\)

之后，慢慢发展到大家想要一些图片传输、视频传输、最后就是音视频的通话了。

所以，多媒体传输，也可以间接理解为：传统的电话/音频传输 转化到 图片、视频了，这就是多个数据源，即：多媒体。

但视频要传输最复杂的地方就是：它太大，网上传输不太现实。

> 这里忽略掉硬件问题，如：半导体存储等

然而，随着时间推移，硬件不断升级，带宽变大。接着编解码的技术产生并成熟后，音视频流的传输才得以被大量民用。

> 1996年 WebEx的创建以及其推出的音视频会议产品是一个非常大的标志。
> 
> 
> 从电话的平民化到 WEBWX的诞生，整整用了100年......

## 基础/流的定义

1. 流：stream，计算机是个电子产品，是用电的。它上面所能处理的数据都是电信号，电流只有 0 或 1 ，传输的数据就是一堆 0 和 1 的电信号 。计算机上的网络传输，简单看，最终都是在类似一根网线上传输电信号。在网线上按照顺序\(时间、连续\)的传输，像水流一样。
2. 流媒体/多媒体：普通的文字其实也算是流，最终它也是0 1 是电信号的传输。只是它的量比较小。而像：视频、音频、图片这些略大的些，并且 音视频是有时间概率，是要连续长时间传输

结合以上两点看：一些较大的数据，在网络中传输，就是：流控。

> 这里的核心是：控，而流更像是基础数据。控：控制数据流的操作

早期的流控处理，大多用移动设备：软盘、硬盘等，在目标机器上，一次性把数据都复制全了，再到本机播放。或者，通过网络一次性把对方的数据均下载完成后，再播放。

早期对数据流的处理，就没有\<控\>这个概念，都是比较简单粗暴的一次性整体复制。当然也是受到带宽、压缩技术等的限制。所以，对一些较多大的流的处理，称为多媒体，有那么点高大上的意思。如：多媒体教室

现在：电影、电视剧都可以直接在用电脑，通过网络基本都可以实时播放了\(1080P\)。这里得意于几个技术点：

1. 大数据\(音视频流\)压缩/解压缩 技术
2. 带宽变大
3. 传输协议的选择与优化

## RT

Real\-time:翻译过来是'实时'，但对'实时'的定义其实有很多种

1. 物理学上，只要有人说话我们立刻就能听见
    1. 如果以'绝对'来衡量这件事儿，那不存实时，因为：声波在空气中传输的速度是确定的，耳模接收后还要转化，最终传向大脑。
    2. 不以'绝对'衡量，我们正常人类说话交流，3~5米是感受不到延迟的，这种也可以算是实时
2. 计算机网络中的实时，把流推到对端，对端'基本'上感知不到延迟

> 这里的核心词：基本，即：人类对延迟时间的大小决定了感知

实时在计算机网络里的难点：只要是走网络\(地域距离、网络带宽、网络波动\(丢包重传\)、防火墙、路由器、阻塞等\)，必定有延迟。'实时'更像是对延迟时间的一种定义。

理想状态下的，计算机网络实时过程：A发送消息，没有任何中转\(路由器\)，在网络上传输数据，直接给到B。去掉中间的：服务器转发及其相关路由。

现实总是很骨感：

1. P2P的直连模式是非法的，无法NAT穿越
2. 网络的异构性：带宽不够、民用网络的复杂性、手机网络与其它网络的不同等等
3. 业务影响，有些使用P2P可以，有些就是多人会议

界内公认对音视频流传输的延迟时间分析：

1. 能保持 在 400MS~500MS 以下，即就算是一个合格的音视频通信了。人类能有一点点感知，但影响不太大
2. 能控制在 200ms 基本是符合 实时的定义了，因为人类对 200MS 基本是无感知的
3. 500MS~1S，用户是完全有感知的了。
4. 1S~3S，用户肯定是能感知的，但不至于关软件
5. 3S以上，这个基本上非常差了，用户可能会删了软件

顺带说下元宇宙：先抛除它的花里胡哨的东西，如果真要实现元宇宙，其中有一条基础功能就是：大数据，低延迟传输，感觉从地域距离上它就死了一半。。。。。

## 非RTC

http:请求\-\>等待\-\>响应\-\>渲染

email:发送\-\>服务器接收\-\>接收者请求服务器\-\>下载邮件

对比RT：

RT模式也做不到100%全双式端到端通信，但它的模式，更倾向于主动推流

1. 某端产生流后，可能直接推到对端，也可能推到服务端/CDN，但服务端基本不做停留会立刻推到对端
2. 两端都可以互相推流，全双工模式

## RTC

Real\-time Communications

大概流程：


  

```mermaid

graph LR

麦克风/摄像头 -->|采集数据| 前置处理

前置处理 -->|美颜-回声-降噪| 压缩编码

压缩编码 -->|H.264-ACC|封装文件

封装文件 -->|mp4-flv| 协议封包

协议封包-->|RTMP推流|网络传输

```

  

```mermaid

graph LR

网络传输 -->|拉流| 拆包

拆包 -->|RTMP-webrtc-Hls| 拆文件

拆文件 -->|MP4-FLV|提取裸流

提取裸流 -->|H.264-ACC| 播放器

播放器 -->渲染

```

1. 数据采集设备：摄像头、麦克风、
2. 前置处理：美颜\(滤镜\)、虚拟背影、3A（回声消除AEC、噪音抑制ANC、自动增益AGC）、变声、netQE
3. 视频\-编解码：VP8/VP9、H.264/H.264
4. 音频\-编解码：ACC、OPUS
5. 音视频流封装文件格式：mp4 flv mkv rmvb avi
6. 网络传输协议:TCP/UDP、RTMP/WEBRTC、HTTP\-FLV/HLS
7. 数据播放：图像渲染、扬声器

技术选型\(协议\)考虑:

1. 延迟
2. 成本
3. 质量
4. 业务场景

#### 注意

RTC的核心是就是实时数据通信，不要把它跟直播、推拉流、录制弄混了。后面再讲具体的区别

## TCP/UDP

整个计算机网络领域，最底层的网络传输协议其实就是2个：TCP 和 UDP，RMTP/WEBRTC/RTP/HLS 协议 底层协议依然是 TCP/UDP

> 特殊行业除外，如：军工设备、医疗设施等

TCP

优点：稳定

缺点：实时性略低、效率性能略低

> TCP因为自带的3个功能：滑窗\(顺序传输、超时重传\)、拥塞控制（限流）、面向连接（3次握手4次关闭），确保了稳定性。

UDP

缺点：不稳定，可能丢包，不管包的顺序

优点：实时性更高、效率性能略高

> UDP因为不需要连接，反正只要有个IP\+PORT，我就发，对面能不能全收到、是否顺序接收、是否丢包 我都不管

总结：TCP UDP 都没有绝对的优势，各有各有缺优，具体还是得看业务场景，像：视频会议这种，那肯定是UDP，实时性最重要。还有直播的1V1互动必须也是UDP。

但像对实时要求不是特别高的，直播推流CDN，TCP 可能更适应一点。也可以两种协议结合使用，不一定非要你死我活，还是看场景

## RTP/RTCP/RTSP

#### RTP

RTP 历史：IETF的多媒体传输工作小组 1996 年在 RFC\-1889 中公布的。后期更新到了：RFC\-3550

> 这个协议只是个规范，具体怎么实现，还得看实现方，如：虽然规范建议是UDP 你也可以用TCP，RTMP 就是 TCP。WEB\-RTC就是UDP

RTP : Real\-time Transport Protocol 实时传输协议

RTCP: RTP Control Ptotocol 实时传输控制协议

RTP 与 RTCP 是一起配合使用的协议，在 UDP 协议这上的。

两端通信时，接收端需要开两个端口号\(一个奇数一个偶数\)，一个\(偶数\)给 RTP 另一个\(奇数\)给 RTCP

> RTP/RTCP 并不一定使用UDP，也可以使用TCP，它只是一个协议规范，具体看实现者，但肯定是在 TCP/UDP 之上的

RTP:头和体

包主要包含3个字段值：payload\(音视频数据\) \+ 包的序列号 \+ unix时间

它只负责数据的传输，不保证数据的顺序、可靠、稳定

> 音视频流媒体，是有时间顺序的，所以 RTP 协议的每个包，得加上时间字段

#### RTCP

RTCP:包格式

 200                  SR（Sender Report）                       发送端报告  

201                  RR（Receiver Report）                     接收端报告  

202                  SDES（Source Description Items）  源点描述  

203                  BYE                                                    结束传输  

204                  APP                                                    特定应用

在开启RTP传输后，两端周期性的再发送RTCP包，其包中可能包含：数据发送总量、丢包总数等统计信息。根据这些信息 接收端可做出些策略，改变RTP的PAYLOAD大小等等。

服务质量的监视与反馈、媒体间的同步，以及多播组中成员的标识。在RTP会话期 间，各参与者周期性地传送RTCP包。RTCP包中含有已发送的数据包的数量、丢失的数据包的数量等统计资料，因此，各参与者可以利用这些信息动态地改变传输速率，甚至改变有效载荷类型

RTP/RTCP总结：

1. RTP RTCP 均使用UDP， RTP 就是负责不停的发送流数据，而RTCP 做一些 稳定性的控制，RTP可以不停的传， RTCP 周期性的传一些小数据，感觉两个协议结合着用还是挺节省带宽资源的
2. RTP/RTCP 更像是学习使用。因为，它确实够简单，可太简单了，且只是个论文偏向理论的东西，实际的应用场景还得继续封装,RTSP就是继续封装的一个协议

#### RTSP

Real Time Streaming Protoco）：实时 流\(音视频\)控协议，端口 554

1. 文本流

> RTP是二进制流

1. TCP

> RTP是UDP

1. 多信道，支持声音流与视频流分流传输

> RTP不支持

1. 不能单独使用，依托 RTP/RTCP

他更倾向于对流的应用层控制，如：视频的 播放、暂停、回退、协商RTP端口号，协议视频的格式参数 等操作

从功能上看，它自己并没有传输流的功能，而需要建立在 RTP/RTCP 之上，靠 RTP/RTCP来传流。准确说应该是：它控制着 RTP/RTCP 的传流方式

它的应用场景：更多的是监控领域，像：摄像头之类的。这里不做过多研究

## RTMP

详细的看下面的连接

https://app.yinxiang.com/fx/e7c08f05\-a22a\-4395\-8c2a\-fc714e2e0fa9

优点：

1. 使用 TCP 保证了一定的稳定性
2. 大部分公司都在用这个协议，所以实践性经得起考验
3. 对 CDN 支持良好

缺点：

1. 延迟略高、卡顿
2. adobe 公司放弃了更新维护
3. 不支持浏览器

延迟大概1~3秒

它的应声场景比较适合：推流，因为 CDN 直接支持 RTMP 协议，间接证明 拉流方只要有个URL即可。

## webRTC

详细参考这里：

https://app.yinxiang.com/fx/2a610f6f\-b58f\-4589\-a200\-0022071d1226

## HTTP\-FLV

adobe 公司出品

它并没有单独开发一套协议标准，而是直接使用 HTTP 协议。 其中用 header 间接实现了流传输：

```
content-length=0
header 中的 range
CHUNK 
Connection: Keep-Alive 做长连接
```

其流程比较简单：直接用 HTTP 协议 拉流到本地，然后播放。它并不关心推流一测，所以这个协议应用的场景是：看视频播放视频，HTTP 大多服务器端口都是开放的，那么，拉流也就兼容性比较好，没什么限制。也不用再专门的在本机上安装个软件了。

如果参照 RTMP 协议的内容传输格式，再看 FLV 类型的封装格式，就发现，这两个东西好像差不多是一样的......

## HLS

HTTP Live Streaming

苹果公司出品，基于 HTTP 协议。。。。

视频的封装格式是TS

视频的编码格式为H264，音频编码格式为MP3、AAC或者AC\-3。

一个大视频文件被切分成若干个小文件 TS，再 用 m3u8 文件 索引列表

m3u8 文件可放在 server 上，而 ts 文件可直接扔到CDN上

对比 RMTP，优点：

1. HTTP 肯定不会被防火墙拦截
2. RMTP 是有状态的，S端做负载略复杂，而 WEB SERVICE 是HTTP 无状态， 负载简单
3. HLS亲爹是苹果，对 IOS MACOS 原生支持. 安卓也被动得支持
4. 支持浏览器

缺点：就是慢，平均大概10S左右，主要它并不是真的长连接实时推，属于间接从 HTTP 下载文件播放

延迟非常高

## 协议对比

|协议名   |公司                      |时间     |TCP/UDP/http|传输格式|延迟率   |封装格式|视频编码   |音频编码|优点                                    |缺点                                                                                                        |兼容浏览器|业务         |播放器                 |
|---------|--------------------------|---------|------------|--------|---------|--------|-----------|--------|----------------------------------------|------------------------------------------------------------------------------------------------------------|----------|-------------|-----------------------|
|RTP/RTCP |开源组织                  |1996     |UDP         |二进制  |200~400ms|不限制  |不限制     |不限制  |简单，适合二次开发                      |只是个论文标准                                                                                              |否        |基础层       |取决收流的设备         |
|RTSP     |网景/RealNetworks         |1996     |TCP/伪HTTP  |文本    |0.5~1秒  |不限制  |不限制     |不限制  |简单，可满足点播需求                    |依赖RTP/RTCP，不兼容浏览器                                                                                  |否        |安防         |取决收流的设备         |
|webRTC   |google/Global IP Solutions|2010     |UDP         |二进制  |200~500ms|        |v8/v9      |opus    |速度快                                  |1. 建立连接复杂，不能秒开 2. 不支持ACC和h.264 3. 各大浏览器厂商兼容差 4. UDP肯定会丢包 5. 人多连接不好做负载|是        |会议/互动直播|h5\-video标签可直接播放|
|RTMP     |adobe/Macromedia          |2012     |TCP         |二进制  |3~5秒    |FLV     |h.264/h.265|ACC     |成熟稳定，适合推流                      |1.两端开放2个端口号 2.ADOBE放弃维护 3.不支持浏览器4. 延迟略高                                               |否        |普通直播/点播|flash\-player          |
|HTTP\-FLV|adobe                     |2008~2016|HTTP        |文本    |3~5秒    |FLV     |h.264/h.265|ACC     |1. 兼容HTTP 2. 成熟稳定                 |1. ADOBE放弃维护 2. 延迟略高                                                                                |是        |直播/会议    |flv.js                 |
|HLS      |苹果                      |2009     |HTTP        |文本    |10秒     |m3u8/ts |h.264/h.265|ACC     |兼容HTTP，支持点播操作，对苹果设备兼容好|延迟太高                                                                                                    |是        |点播         |video.js               |

兼容HTTP代表什么？

1. 这个流一定能在两端通信/传输数据，因为两端的网络不管多么复杂（防火墙），但 80端口肯定是开放的
2. 浏览器肯定是能直接播放的，不需要开发 APP，也不需要开发 播放器，跨OS、 跨手机/PC

直播里更多的倾向是：RTMP FLV HLS

通话领域更多：WEBRTC

监控：RTSP gb28181

不要纠结为什么这各行业的协议都不太一样，因为：各行业都有其核心的痛点，不可能某个行业改变另外一个行业。

如：监控更强调的是能够回放

直播：流畅\+视频分辨率

会议：更强调延迟

而复杂的就就在于 ：这些行业全要接入互联网，或者也可以叫做企业数字化

一但这些全要接入互联网，这里就牵扯到一个东西：音视频网关

这里有个段子，flash 不行了人尽皆知，行业内的人，尤其开发者，都明白，2013年就明白。开发者们也一直早早估算flash 连带的 rtmp也不行了，应该换 DASH。但讽刺的是直到现在 直播行业的主要推流协议还是 RTMP，拉流方的主流协议依然还是 flv hls。

我的理解是：技术只是技术，市场需求才是对技术最好的驱动。一个协议稳定了10多年，所有设备也都安装使用了，换掉它，有多大回报？用户对于你是 RTMP 还是SRT DASH 是不知道，你只提升了100MS的时间，用户是无感知的。

## 播放器

它的核心功能：

1. 解 音视频数据 封装的文件
2. 解码 音视频数据，还原成最原始的数据
3. 告知硬件播放：显卡、声卡

播放器的分类：

1. 纯正的一个软件，就是用来播放音视频
2. APP内嵌入的一个小型播放器类库，没有单独的完整UI，只有些简单的UI
3. 浏览器内部的一个插件，有些简单的UI

从用户的角度看：它其实更像是一个适配器

1. 能够兼容各种文件类型的音视频文件、能够解析各种编码后的数据
2. 能有些简单的操作控制，播放/暂停、回退、快进、静音等
3. 选择声道、语言、字幕
4. 对视频有些简单的操作：放大、缩小、旋转、截图、录屏
5. 最终播放

常用播放器：

1. ijkplayer

> 客户端式的播放器,B站开源的。

1. ffplay.c

> 客户端式的播放器，包含在 ffmpeg 中

1. flv.js

> 纯JS编写，bilibili 开源，原理：将flv流转换成mp4流，最后交给 html\-video 标签播放，适用于浏览器

1. video.js

> 就是用来兼容HLS，主流浏览器video标签支持格式：mp4 webM ogg ，苹果的浏览器倒是可以直接用 video 标签，播放 m3u8 ，但是 chrome 就得有 video.js 做转换，再返给 video标签

1. flash player

> adobe出口，曾经红极一时，主流浏览器都要安装的插件。但随着时代的发展，落没了，并且adebe公司自己都放弃维护了。

如果真要是自研，这里至少得熟悉掌握一款播放器，并读过它的一些源码/构架，因为自己开发的时候，有个参考。或者就算是选择开源的播放器二次开发也得熟悉里面的套路。又或者优化调错的时候也得用到它。

## 延迟

网络抖动延迟、解码延迟、渲染延迟

其中：解码延迟、渲染延迟 比较稳定，网络抖动这个才是核心

先从业务上看：

1. 点播，如：看电视/电视剧，这种宽泛看不存在延迟，不需要那么高的实时性，真是网络不好，降码率，或播放器多缓存一会，总得来说问题不太大，毕竟视频流在本地。
2. 直播/会议，这个对延迟率有要求，准确的说是：像互动/会议 这种对延迟率相当高

普通直播对延迟要求也没那么太高，本质是拉流，延迟个1~3秒问题不大，而互动直播/会议，这种就得优化一下，一般延迟 100ms~200ms 人类略有感知，但能接受。200ms~400ms 左右，感知略大一些，但勉强能接受，但400ms~500ms 以上的话就行了。

所以，业内对延迟的容忍度大多定在400ms~500ms左右，也算是一个标准吧，能做到这个范围内的RTC构架体系算是合格，能做到200ms 的就很好了。

拿到的数据，只要每个环节有处理逻辑都有可能延迟，结合整个流程做分析：

1. 硬件采集数据时，可能它自己的驱动就有缓存队列
2. 数据流预处理时
    1. 数据过大，如4K数据，预处理的算法极限是2K
    2. 预处理的算法本身就有问题，设备给到每秒20帧的数据，而算法每秒只能处理15帧
3. 编码/解码
    1. 据过过大，CPU/GPU 计算不过来
4. 推流，要选择好一个较好的协议
    1. 像直播互动最好用WEBRTC\(udp\)
    2. 普通的直播用RTMP\(TCP\)
5. 网络传输过程
    1. 网络波动
    2. 物理距离
6. 服务器OS 收数据
    1. 计算机基础，网卡与CPU的零复制、MMAP、深浅COPY、减少内核态用户态切换频率等等
    2. socket IO 收数据流时，缓存的时间
7. 播放器的缓存队列
    1. 网络波动瞬间过来大量帧，要么丢掉，要么快速播放

协议对网络包拆包，协议之间的数据转换，最后，对端从服务器拉数据也会产生一定的延迟

## 旁路推流

如果两端都有 APP/SDK ，这种正常推/拉流，播放视频问题不大的。

但，有些场景下，就不行，如：

1. 用户就只有个浏览器，这个流是解不开的，或者不好解。那就得把自有流推到某个服务器上，转成 RTMP/HTTP 格式，这样浏览器基本就兼容了
2. 两人互动直播，一堆用户观看，观看者要想看到两个人的视频流，得同时获取到两人的视频流，浪费带宽。这个时候得得合流，那么，在没有 服务器\(转换\)的前提下，就得单独有个服务做合流，最后再配合第一条
3. 转码，参与会议的人/观看的用户，设备肯定是不一样的，有些能支持高分辨率，有的带宽又跟不上，就得给流做转换，再配合第一条
4. 把数据流推到 CDN 上，CDN 可以起到 物理加速、负载均衡的效果
5. 政审，其它国家不清楚，中国，是有明文规定的，要做P2P通信，必须得有备份/录制，进行3方监管

旁路推流其实就是一个服务程序\+服务器，有需求的就直接开一个3方服务就行。

如果我们有自研能力，自己搞一套MCU/SFU 也可以不用旁路推流

## 业务类型

1. 直播
    1. 普通直播，被动收流
        1. 赛事直播 ，乐视、斗鱼/虎牙/YY
        2. 带货直播 ，抖音/快手/淘宝
        3. 在线教育 ，VIPKID、好未来、新东方
    2. 互动直播
        1. 视频会议/视频聊天 ， BOSS面试、微信/QQ、腾讯会议
        2. 连麦直播 ，抖音/快手
        3. KTV

> 数据源：是由 摄像头 生成。用户对流没有控制权，不能快进、回退等。

1. 点播
    可以任意播放一个音视频文件，如：快进、回退等
    1. 长视频，电影/电视剧，优酷/腾讯/爱奇艺等
    2. 短视频，抖音/快手

> 数据源：是提前录制好，放在服务器上。用户可以跳到文件的某个部门观看，也可以快进、回退等
> 
> 
> 点播也可以间接理解为双向流

1. 安防/监控
    1. 公共摄像头，大华 海康 华为
    2. 家庭摄像头，360、小米
2. 云游戏

对于技术实现而言：直播是一个较完整的流控，要接通 摄像头，要采集数据，要做预处理\(降噪/回声抑制等\)。

而点播相对简单些，它不需要采集数据源，也不需要预处理，它关心就是拉流与播放

#### 总结：

长视频的网站是一种构架，短视频、直播、安防都有各自不同的构架，而一个牛逼的RTC平台，是需要兼容所有业务种类的。。。

## 难点/关键点

1. 兼容性
    1. 不同设备/硬件\(PC/手机/pad\)
        1. 发送方的音频采集速率是128 ，接收方的声卡仅支持64
        2. 发送方的摄像头是680的，接收方的手机就是 1080 的
    2. 不同OS\(win/macX/ios/andriod\)，像苹果的OS是纯闭源，对RMTP协议兼容性就不太好，而对它自己的HLS协议兼容就很好
    3. 不同容器\(app/browser\)，可能发送方用的是APP，而接收方是浏览器
2. 数据传输
    1. 中间层协议，RMTP/webRTC/HLV
    2. 底层协议,TCP/UDP
    3. 稳定性，丢包、重传
    4. 延迟，各个节点产生的延迟，比如：视频流是2K，本就有点大，美颜的算法又有点差，根本处理不过来，就会产结果：要么延迟过高，要播放卡顿丢帧
3. 音视频流
    1. 采集
    2. 编解码,IBP PCM
    3. 预处理
4. 技术知识储备，对比传统的开发，RTC的信息量太大了，像：
    1. 网络协议层，底层协议、中层协议、应用层协议，协议转换、延迟率、丢包 等等
    2. 音频、视频基础
    3. 音视频编解码
    4. 音视频流的预处理
    5. 分布式节点部署，如: CDN nginx\-rtmp
    6. 硬件设备，声卡、摄像头
    7. ......

网络传输的难题：延时、乱序、丢包\(重传\)、抖动

## 自研

#### 人力成本

|工种   |分类  |详细                           |人数|
|-------|------|-------------------------------|----|
|IOS    |移动端|数据采集/编解码/文件封装/播放器|1   |
|IOS    |移动端|前置处理/协议传输/sdk          |1   |
|andriod|移动端|数据采集/编解码/文件封装/播放器|1   |
|andriod|移动端|前置处理/协议传输/sdk          |1   |
|JS     |浏览器|数据采集/编解码/文件封装/播放器|1   |
|JS     |浏览器|前置处理/协议传输/sdk          |1   |
|UNITY  |眼镜  |数据采集/编解码/文件封装/播放器|1   |
|UNITY  |眼镜  |前置处理/协议传输/sdk          |1   |

|工种       |分类|详细                                                              |人数|
|-----------|----|------------------------------------------------------------------|----|
|运维       |后端|开源软件安装、CICD部署、监控/报警、云服务器维护及CDN维护、旁路推流|1   |
|C\+\+      |后端|webRtc RTP/RTCP                                                   |1   |
|C\+\+      |后端|rtmp/rtsp                                                         |1   |
|C/C\+\+    |后端|底层 LINUX TCP/UDP                                                |1   |
|C\+\+      |后端|编解码/文件合并拆分、合流转码                                     |1   |
|C\+\+      |后端|文件合并拆分/编解码、音视频合流/转码率/转分辨率/流格式转换        |1   |
|java/golang|后端|标量统计传输、监控/报警策略、CICD部署策略                         |1   |
|构架师     |后端|分布式/CDN/服务器节点                                             |1   |

前端8人 后端8人 合计：16人

> 这里需要注意下：RTC的开发并不是传统的CURD，对人才的要求非常高，尤其C\+\+岗，人难招，且工资又很高。

#### 工期

目前没有类似的人才，所以招人也得有个过程，不可能一次招全了，所以计算工期也得因环境而议。

在人全的情况下：16个人全速开发，再用一些开源的软件/类库，乐观估计2~3月左右吧

#### 其它成本

1. 宽带

> 视频流是非常吃宽带的，光宽带的费用就会很贵

1. 服务器集群

> 各服务的节点不可能单服务器，至少也得有4个大城市群\(长三角、珠三角、京津冀、成渝\)部署若干台服务器

1. CDN加速

> 就算在4大城市群有服务器，但是还有若干的城市得有服务器节点，进行加速，都自己部署太贵了，得把其它小地区的节点交给 CDN

1. 旁路推流

> 像转码、CDN推流、合流等这些业务自己可以做，但也可以将一部分拆分开，这样减少自己服务器的压力

## 市场上的云通信/RTC服务

严格来说，我只用过声网，具体为什么用不清楚，反正公司的人都在用且推荐。另外，用过 ZOOM，但它更像是个一体化的软件，而不是3方技术服务。所以，我也不清楚其它家到底怎么样...

主流的：

1. 声网 纳斯达克
2. 容联云 纽交所
3. 即构
4. 阿里云
5. 华为云
6. 腾讯云
7. Twilio\(美国\)

> 分析:声网跟容联云是国内专注于云通信的，且在美国上市。而3家传统云公司也在紧锣密鼓部署云通信业务。

1. 声网跟容联云
    优点：是比较专注于音视频通信
    缺点：没有3家传统企业做爸爸，也没有3家的云服务做基础设施，前景略有点难
2. 阿里云/华为云/腾讯云
    优点：有较为完善的基础云设施，都有背后的爸爸，比较看好
    缺点：有背景但估计做事情会很慢，很复杂，不好实施
3. 即构，不太熟悉，具说是腾讯的20个通讯领域的专家出来创业的。应该跟声网 容联云差不多，没有爸爸，专注于音视频的，前两者大。听话也不错
4. Twilio 是美国的公司，就做个简单标注吧。它的体量是 声网\+容联 的 10 倍......

声网跟容联云对比：

容联云 股价： 0.72美元。。对没看错。。。。 感觉要挂了呢

声网 股价：4.2美元

> 两个都是难兄难弟啊

容联云主打的是PAAS/SAAS，声网应该更专注于云通信。不过，两家的日子都不太好过，好像都还在持续亏损。

> 这其实也验证了我上面的分析，传统 BAT 来抢生意，你就没得玩儿。不过，声网也在努力在部署海外市场，同时，开发新的业务，像：VR/AR、IOT 等领域

这里我个人的想法是：目前可以选择小而美的，像：声网、即构这些，但最终可能还是 阿里/华为/腾讯的天下......

## 总结

#### 从技术角度看：

1. RTC的核心就是流的控制，它是我弄过最复杂的构架

> 注：是复杂，不是最难的，如：特征提取、卷积和、傅里叶变换、贝叶斯、神经网络等这些是真的很难。

1. 复杂的点：需要的知识储备量非常大，前端、移动端、后端、硬件，还有一些基础的物理知识：声波、光。需要学习的知识点太多。
    对比微服务看：它需要大量的前端、移动端的知识，还有硬件及基础物理知识。甚至还得了解下GPU、OPENGL 渲染等等
    对比前端构架：它需要大量的后端知识，像：TCP/UDP，NAT 穿越，分布式，各种流控协议等等，还有硬件及基础物理知识。还有音视频的编解码等
2. 对程序员而言，如果真的能自研一套这样的体系，那身份翻倍不是梦。并且，再结合传统的CURD的构架，再做构架那真是游刃有余

#### 从成本上看：

1. 带宽是个大头，主要城市的服务器集群必须要有，还得配合 CDN 做加速，成本是真的很贵....
2. 招人会非常难，薪水也会非常高

#### 结论就是：没有个10年的脑血栓，轻易不会自己搞这套构架体系的...... 或者只实现一部分功能，不做架构

> 着实体验了一把：从入门到放弃...

## 知识体系

文档太大了，卡死，想要找我吧

## 流程图

文档太大了，卡死，想要找我吧
